# (5) ChatGPT 

## Техническое задание: оптимизация контента карточек товаров Ozon с помощью LLM

Введение и цели проекта

Данный проект направлен на автоматизированный анализ и доработку контента карточек товаров Ozon с использованием возможностей больших языковых моделей (LLM), в частности OpenAI ChatGPT. Цель - повысить контент-рейтинг карточек до максимального значения (100 баллов), учитывая замечания и рекомендации, которые предоставляет платформа Ozon для улучшения карточек. Это позволит сделать товары более привлекательными для покупателей и улучшить их положение в выдаче Ozon.

Основные задачи на текущем этапе: провести анализ существующего контента товарных карточек, выявить недостатки на основе контент-рейтинга Ozon, автоматически сгенерировать или предложить правки (текст, мультимедиа, данные) с помощью LLM и подготовить конкретные рекомендации по корректировке. Результатом будет подробное техническое задание (ТЗ) для разработчиков, которое можно передать команде (или агентам Codex) для быстрой и идемпотентной реализации в среде .NET 8.

## Обзор решения

## Общая схема работы системы:

1. Интеграция с Ozon API - Система подключается к Ozon Seller API для получения данных о товарных карточках. В первую очередь используется метод получения контент-рейтинга товаров (endpoint POST /v1/product/rating-by-sku) (1). Этот метод возвращает текущий балл контент-рейтинга и рекомендации по его увеличению (список несоответствий и незаполненных элементов) для указанных SKU (1). Также при необходимости система запрашивает подробную информацию о товарах (название, категория, атрибуты) и текущее описание товара через соответствующие методы API (например, POST /v3/product/info/list|для общей информации о товарах и |POST / v1/product/info/description|для текста описания) (2) (3).
2. Анализ LLM (ChatGPT) - Получив от Ozon данные о том, какие элементы контента не соответствуют требованиям максимального рейтинга, система формирует запрос к модели ChatGPT. LLM проанализирует текущий контент карточки (описание, заголовок, характеристики и пр.) с учётом замечаний Ozon и сгенерирует исправленный контент: например, дополнит или перепишет текстовое описание, подготовит черновой вариант Rich-контента (структурированного JSON с мультимедиа) и предложит формулировки для отсутствующих полей. Модель будет снабжена инструкциями по правилам оформления Ozon (например, требование не включать запрещённую информацию, выдерживать тон и стиль описаний) и сведениями о товаре. OpenAI ChatGPT API будет использован для интеграции LLM в .NET 8 приложение (возможна реализация через официальную .NET библиотеку OpenAI (4).

3. Формирование правок и обновление карточки - На основе предложений LLM система формирует набор правок: заполненный JSON описания (Rich-контент), обновлённый текст описания, дополнительные атрибуты товара, ссылки на видео и обложки, изображения и т.д. Затем через Ozon API выполняется обновление карточки. Для массового или единичного обновления будет использован метод | POST /v3/product/import (импорт/ обновление товара) ( 8 , принимающий структуру с новыми данными карточки. В эту же структуру можно включить ссылки на изображения, видео и другие атрибуты контента (7) (8). Ozon API в ответ возвращает идентификатор задания на обновление; система проверит статус выполнения через метод статуса (например, | GET /v1/product/import/ info или аналогичный) и убедится, что карточка обновлена успешно.
4. Проверка результатов (идемпотентность) - После обновления контента система повторно запрашивает контент-рейтинг данного товара через |rating-by-sku| и проверяет, достигнут ли 100 баллов. Если да, задача считается выполненной для этой карточки. Если нет - LLM и правила применяются повторно для тех пунктов, которые всё ещё не выполнены. Такой цикл гарантирует идемпотентность: повторный запуск обработки карточки, уже приведённой к максимуму, не будет вносить изменений, поскольку контент-рейтинг покажет отсутствие незакрытых замечаний. Система всегда ориентируется на актуальные данные Ozon; если карточка уже идеальна, LLM ничего нового не добавляет, обеспечивая консистентность результатов при многократных запусках.

Ниже приводятся детали по каждому из компонентов решения: интеграция с API Ozon, требования для максимального контент-рейтинга, использование LLM для доработки контента, пошаговый алгоритм работы и учёт ограничений технологии.

# Интеграция с Ozon Seller API (методы и структуры данных) 

Для решения задачи используются следующие методы Ozon Seller API (с соответствующими DTO форматами запроса/ответа), описанные в документации разработчика Ozon:

- Получение контент-рейтинга товара - Метод | POST /v1/product/rating-by-sku|. Назначение: вернуть текущий контент-рейтинг (от 0 до 100) для одного или нескольких SKU, а также дать рекомендации по повышению этого рейтинга (1). В теле запроса передаётся массив SKU товаров. В ответе приходит JSON со списком товаров и для каждого - поле |rating |(числовое значение рейтинга) и разбивка по группам параметров, влияющих на рейтинг. Пример фрагмента ответа для товара показан ниже:
![img-0.jpeg](img-0.jpeg)

![img-1.jpeg](img-1.jpeg)

В структуре ответа каждая группа (groups) характеризует отдельную сферу заполнения карточки: важные атрибуты, остальные атрибуты, текстовое описание, медиа-контент. Внутри перечислены условия (conditions) с описанием и флагом fulfilled (выполнено или нет) и "ценой" в баллах ( cost ), которую даёт выполнение этого условия (18) (19). Невыполненные условия по сути являются замечаниями Ozon - теми элементами, которые нужно исправить, чтобы увеличить рейтинг. Также может присутствовать массив improve_attributes идентификаторы и названия атрибутов, которые стоит заполнить, и поле improve_at_least сколько таких атрибутов минимум добавить для улучшения рейтинга (11).

- Получение информации о товаре - Метод POST /v3/product/info/list.

Назначение: вернуть основные данные товара по его идентификатору, SKU или вашему внутреннему Offer ID (22) (23). Можно запрашивать данные сразу по нескольким товарам. В ответе приходит массив объектов items с полями: название name, идентификаторы, цена, наличие, категория, статусы модерации, ссылки на изображения, и др. (необязательные поля, в том числе описание, могут отсутствовать или быть пустыми, если требуют отдельного вызова). Этот метод полезен для получения атрибутов товара и другой сопутствующей информации, которая может потребоваться LLM для контентгенерации (например, основные характеристики, бренд, цвет и т.д., если они уже заполнены). Данный метод не возвращает длинное текстовое описание (его Ozon вынес в отдельный метод), но предоставляет description_category_id и структурированные атрибуты.

- Получение текстового описания - Метод POST /v1/product/info/description.

Назначение: получить текущее текстовое описание товара по его SKU или ID (24). В ответе возвращается текст в поле description (а также дублируются идентификаторы и название товара) (13). Этот метод нужен, чтобы подтянуть существующее описание из карточки - LLM может проанализировать его качество, длину, наличие ключевой информации, а также использовать его содержимое при генерации улучшенного варианта (чтобы сохранить фактическую информацию о товаре). Если описание пустое, это сразу отражается на условиях контент-рейтинга (как минимум невыполнены условия по длине аннотации).

- Обновление (импорт) карточки товара - Метод POST /v3/product/import.

Назначение: создать новый либо обновить существующий товар, передав полную структуру карточки (25). Это основной метод для внесения исправлений: в теле запроса

нужно сформировать JSON с новыми данными карточки. Ключевые поля структуры включают:

- offer_id - ваш внутренний артикул товара (уникален для вашего ассортимента);
- product_id или sku - можно использовать для обновления существующего товара (один из идентификаторов обязателен);
- name - название товара;
- description - текстовое описание (аннотация);
- description_category_id - ID категории описания (определяет шаблон

структурирования контента, обычно равен category_id товара или связанной категории описания);

- Массив images - ссылки на изображения товара;
- Поле attributes - массив объектов характеристик (каждый содержит id характеристики и значение value или dictionary_value_id для справочных атрибутов);
- Поле complex_attributes - сложные атрибуты, куда относится, например, Rich-контент JSON и связанные с ним элементы, а также прикрепление видео;
- Другие поля: габариты, вес, цена, VAT и прочие стандартные данные.

Метод import асинхронный: в ответе возвращается task_id операции 14. Необходимо опрашивать статус выполнения (метод GET /v1/product/import/info no task_id, или обновлённый метод в версии v3/v4 API) и убедиться, что статус импорта успешный. При успешном обновлении изменения сразу вступают в силу в карточке товара.

Примечание по DTO: Чтобы упростить формирование правильной структуры JSON, Ozon API предоставляет вспомогательные методы: например, POST /v1/product/description/json для добавления Rich-контента и POST /v1/product/media/add для добавления видео, но в данном ТЗ мы можем сразу формировать итоговый JSON для product/import. Также доступен метод получения шаблона структуры товара (/v1/product/import/structure), однако мы можем опереться на документацию и примеры. В примере кода Ozon виден способ добавления видео через complex_attributes достаточно добавить в массив complex_attributes объект с вложенными атрибутами видео. Для видео Ozon ожидает два атрибута: ссылку на само видео и идентификатор видеообложки или название видео. Пример: атрибут с id 21841 - ссылка на видео (например, на Rutube или YouTube), атрибут с id 21837 - условно имя видео или идентификатор позиции (7) 8. Аналогично для видеообложки используется отдельный id (например, 21845 - ссылка на изображение-обложку). Rich-контент JSON добавляется как комплексный атрибут с определённым id (в примере контент-рейтинга фигурировал id 11254 с названием "Rich-контент JSON" 11) - значение этого атрибута содержит JSON-код расширенного описания. LLM будет генерировать содержимое для этого JSON (структуру разделов с текстом, списками, изображениями и т.д.), а система вставит его как строку в соответствующий атрибут при импорте.

- Другие методы: при необходимости используются POST /v1/product/import-by-sku (обновление по SKU без передачи нового offer_id) и отдельные методы для добавления изображений или изменения статуса товара. Однако, основная логика может быть реализована через комбинацию перечисленных выше методов. Также, если требуется массовая обработка множества товаров, можно использовать POST /v2/product/list для получения списка всех товаров продавца (с фильтрацией по статусу, категории и т.д.), а затем по каждому получать рейтинг и описание. В рамках данного ТЗ предполагается, что у нас есть на входе список конкретных SKU/ID, требующих оптимизации.

Идентификация и безопасность: Для всех вызовов Seller API требуются заголовки Client-Id и Api-Key вашего аккаунта продавца 15 16. Эти ключи должны храниться в конфигурации системы (например, в защищённых настройках .NET) и использоваться во всех запросах к Ozon.

# Требования для достижения максимального контентрейтинга 

Чтобы карточка товара получила 100 баллов контент-рейтинга, необходимо выполнить все основные рекомендации Ozon по заполнению контента. На основе документации и известных условий контент-рейтинга выделим следующие ключевые моменты:

- Заполнение атрибутов товара: Ozon делит характеристики на важные и остальные. Максимальный балл достигается, если заполнены по крайней мере 2 важнейших атрибута и более $70 \%$ всех важных атрибутов (9), а также минимум 2 любых дополнительных атрибута и более 50\% остальных необязательных характеристик 17. То есть, нужно предоставить как можно больше данных о товаре: технические характеристики, размеры, материал, комплектация и пр. Если каких-то сведений нет, их следует запросить у менеджера товара или производителя, поскольку LLM не должен придумывать факты. Задача LLM в этом случае - помочь выявить, каких именно характеристик не хватает (сравнив описание и атрибуты) и напомнить об их необходимости. В рамках реализации: система на основе improve_attributes из ответа рейтинга получит список ID и названий недостающих атрибутов, которые нужно заполнить 18. Если возможно автоматически получить их значения (например, цвет или размер упоминаются в тексте описания), LLM может извлечь эти данные и структурировать для отправки через API. B остальных случаях необходим либо ввод со стороны пользователя, либо заполнение дефолтными значениями по согласованию.
- Длина и качество текстового описания: Ozon рекомендует заполнять «аннотацию» товара достаточного объёма. Из условий рейтинга известно, что описание длиной свыше 100 символов и свыше 500 символов даёт дополнительные баллы 19. Максимум в этой категории достигается, если текст описания не менее 500 символов. Поэтому LLM будет использоваться для генерации развернутого, информативного описания, включающего основные преимущества товара, его особенности, применение и т.д., чтобы удовлетворить этому требованию. Кроме объёма, важно качество: текст должен быть грамотно написан, без ошибок, без запрещённых слов (например, упоминаний конкурентов, контактной информации, сравнений не по правилам и проч.). LLM (предварительно обученный на большом корпусе текста) поможет улучшить стилистику и убедительность описания.
- Rich-контент (расширенное описание): Наличие мультимедийного расширенного контента - один из самых весомых факторов. В примере рейтинга отсутствие Richконтента имело стоимость 100 баллов (то есть половину всего рейтинга) внутри группы "Текстовое описание" 11. Добавление Rich-контента (специального JSON с описанием, включающим изображения, таблицы, списки, видео и другие элементы оформления) является обязательным шагом для достижения 100/100. Система должна сгенерировать JSON-контент, соответствующий требованиям Ozon: обычно Ozon предоставляет шаблоны или конструктор для Rich-контента, включающего разделы типа "Описание", "Преимущества", "Характеристики", возможно, галереи изображений. LLM сможет на основе обычного текстового описания создать структурированный вариант: например, выделить ключевые пункты в списки, придумать заголовки секций, краткие описания для них. Разработчики интегрируют этот JSON в поле атрибута Rich-контент JSON (ID поля

меняется в зависимости от категории, в примере - 11254) при обновлении товара 11. Следует учитывать ограничения Ozon по структуре JSON (нужно ориентироваться на актуальную схему в документации Ozon: как минимум, валидность JSON, поддерживаемые теги/блоки, ограничения по размеру 100 КБ и пр.).

- Медиа-контент: фотографии и видео: Карточка должна содержать качественные изображения и желательно видео. По условиям рейтинга, наличие минимум 3 фотографий дает максимальный балл за изображения 18. Поэтому, если в карточке меньше трёх изображений, необходимо добавить дополнительные фото товара. (Вне рамок LLM: это задача менеджера контента - предоставить фотографии. Однако система может контролировать этот пункт и пометить карточку для доработки изображений, либо запросить изображения у пользователя). Видео: Ozon поощряет добавление видеоролика о товаре и обложки к нему. Наличие хотя бы одного видео и видеообложки приносит значительные 80 баллов в категории "Медиа" 19. Для максимального рейтинга нужно добавить оба: ссылку на видео (например, обзор товара) и ссылку на видео-обложку (кадр-превью или постер). Система должна поддерживать добавление этих элементов: в структуре обновления через API они передаются либо как часть | complex_attributes 7 , либо отдельными методами. Предполагается, что видео-контент (ролик, хостинг) и изображение-обложка предоставляются маркетплейсом или загружены продавцом заранее (LLM не создает видео, но может сгенерировать сценарий или текст для видео при необходимости). Если видео отсутствует, контент-рейтинг 100 недостижим, но мы стремимся реализовать поддержку этого функционала, чтобы пользователь системы мог дополнить карточку видеофайлом.
- Прочие улучшения: Помимо перечисленного, система должна учитывать и иные возможные рекомендации Ozon. Например, заполнение бренда (важно, если бренд не указан), правильная категория товара, наличие уникальных продажных аргументов. Эти моменты могут не отражаться напрямую в контент-рейтинге, но влияют на модерацию и конверсию. LLM может анализировать текст на наличие стоп-слов или неверных утверждений и исправлять их. Кроме того, стоит убедиться, что заголовок (name) товара соответствует требованиям Ozon (не слишком короткий, содержит ключевые слова, без перечисления характеристик) - при необходимости LLM может предложить скорректированный заголовок, хотя оценка заголовка отдельно не входит в контентрейтинг, это больше вопрос поисковой оптимизации.

Суммируя: для каждой карточки система должна выполнить всё необходимое для получения 100 баллов контент-рейтинга, включая заполнение достаточного числа атрибутов, написание расширенного текстового описания >500 символов, добавление Rich-контента JSON, минимум 3 изображений, а также интеграцию видеоролика с обложкой 19 18. Все эти элементы либо будут сформированы автоматически, либо помечены для ручного добавления (в случаях, где нужны внешние материалы). Результатом корректировок должен стать пересмотренный Ozon'ом рейтинг $=100$.

# Использование LLM (ChatGPT) для анализа и генерации контента 

Роль LLM в системе - обеспечить интеллектуальный анализ контента и генерацию улучшений, имитируя работу опытного контент-менеджера или копирайтера, знакомого с требованиями Ozon. OpenAI ChatGPT будет использоваться через OpenAI API (модель GPT-4 или GPT-3.5-turbo, в

зависимости от необходимого качества и скорости). Ниже перечислены конкретные аспекты, как LLM будет применяться:

- Анализ замечаний и понимание контекста: Получив от Ozon API сведения о невыполненных условиях (например, отсутствует Rich-контент, короткое описание, не добавлено видео и т.д.), система формирует для LLM подробный prompt, содержащий:
- Краткую сводку о товаре: название, категория, ключевые уже заполненные характеристики (например, размеры, материал, бренд и т.п. из product/info ).
- Текущее описание товара (если есть) - чтобы модель понимала, что уже сказано и в каком тоне.
- Список обнаруженных недостатков/замечаний из контент-рейтинга. Например: "Описание слишком короткое (менее 500 символов)", "В карточке нет расширенного описания (Richконтента)", "Добавьте видеообзор товара", "Не заполнены характеристики: Материал, Страна производства".
- Дополнительные инструкции, имитирующие требования Ozon: например, на каком языке должен быть текст (для российского Ozon - разумеется, на русском), стиль (информационный, убедительный, без лишней рекламы), отсутствие капслока, эмодзи, контактных данных, соблюдение юридических ограничений (никаких сравнений, гарантий и т.п., если это запрещено в правилах).
- Генерация текстового контента: LLM на основе этого prompt'a должно выдать несколько элементов:
- Обновлённое описание товара - связный текст, примерно 800-1200 знаков (чтобы с запасом превышать 500 символов), раскрывающий преимущества товара. Например, если товар - это чехол для смартфона, описание должно включать: совместимость с моделями, материал изготовления, особые свойства (ударопрочный, водоотталкивающий), что получает покупатель, почему этот товар качественный. Модель генерирует этот текст соблюдая нейтрально-позитивный стиль и употребляя ключевые слова.
- Структура для Rich-контента - возможно, в виде Markdown или pseudo-JSON, которую потом проще конвертировать. Например, модель может предложить 2-3 секции: "Особенности", "Характеристики", "Комплектация" с короткими описаниями и пунктами. Она не знает точной JSON-схемы Ozon, но мы можем заранее дать образец JSON-шаблона (в виде System prompt) или попросить сформировать список секций с их заголовками и текстом, а разметку JSON сделать уже программно. При наличии в входных данных ссылок на изображения или видео, модель может встроить указание где их разместить (напр., "Изображение_1: показывает товар спереди").
- Предложения по атрибутам - если в замечаниях значится отсутствие некоторых характеристик, LLM может попытаться вывести их из контекста. Например, если в названии товара "Чехол для iPhone 13 из силикона", модель поймет, что материал: силикон, модель устройства: iPhone 13. Эти данные она может явным образом перечислить. Однако, LLM может ошибаться в фактах, поэтому система не будет слепо доверять сгенерированным атрибутам. Скорее, эти выводы послужат подсказками для разработчиков или пользователя: например, модель скажет "Материал: силикон (заполните характеристику Материал)", "Совместимость: iPhone 13". Далее программа сверит: есть ли такие атрибуты в категории (через справочник атрибутов категории, который можно запросить методом /\{category_id\}/attributes - Ozon API предоставляет список характеристик для категории товара). Если да - можно

автоматически подставить. Если модель предположила то, чего нет или не уверена лучше вынести в лог/отчёт для ручной проверки.

- Генерация рекомендаций по медиа: LLM может также сгенерировать текстовые рекомендации, как закрыть медиа-пробелы. Например: "Рекомендуется добавить видеообзор, демонстрирующий товар в использовании" - эту фразу можно отобразить пользователю. Автоматически создавать видео система не сможет, но такое сообщение может триггернуть менеджера загрузить видео. Впрочем, если у нас есть шаблонные видео (например, общий ролик бренда), разработчики могут настроить подключение ссылки на него. То же касается изображений: LLM может указать, какие дополнительные ракурсы товара стоит показать, но решение остаётся за человеком. Тем не менее, в Richконтент JSON модель может заложить блоки под видео и картинки (с заглушками), чтобы контент получился комплексным. Позже скрипт может заменить заглушки на реальные ссылки или удалить незаполненные блоки.
- Взаимодействие с пользователем через чат: Пункт о "OpenAPI ChatGPT для пользовательского ИИ" подразумевает, что мы планируем также предоставить интерфейс (например, чатбот в личном кабинете контент-менеджера), куда пользователь сможет писать запросы, а AI будет отвечать относительно улучшения карточек. Это расширение функционала, но оно вытекает из основной системы. Например, пользователь может спросить: «Что нужно исправить в карточке SKU123?» - бот обращается к системе, получает контент-рейтинг и отвечает (с помощью LLM) списком проблем и советов. Или: «Сгенерируй описание для нового товара $X$ » - бот, зная категорию $X$, запросит у пользователя ключевые параметры и составит текст. Таким образом, ChatGPT API выступает не только как бэкэнд для автоматических правок, но и как пользовательский ассистент. Архитектурно это может быть реализовано в виде дополнительного модуля чат-интерфейса, использующего ту же модель и данные. В данном ТЗ достаточно предусмотреть возможность такой интеграции: все наработки (получение данных из Ozon, формирование промптов, генерация контента) могут быть переиспользованы в режиме диалога с человеком.
- Реализация в .NET 8: Будет создан сервис (консольное приложение, веб-сервис или Azure Function) на платформе .NET 8, который обращается к OpenAI API. Желательно использовать официальную .NET-библиотеку OpenAI $\approx$ или REST-вызовы через HttpClient. Важный момент - обеспечить обработку русскоязычного текста. Модель GPT-4/3.5 отлично поддерживает русский, но при формировании prompt'ов надо явно задавать язык ответа. Также, для стабилизации выходов, можно применять технику few-shot: дать модели пример правильного описания товара аналогичной категории, чтобы она понимала формат. При тестировании нужно проверить, что тексты соответствуют тону Ozon (вежливый, без лично обращений к читателю на "вы" или "ты", скорее нейтральное описание).

Выход LLM будет тщательно обработан перед применением: - Любые данные, влияющие на фактическую достоверность (атрибуты, характеристики) будут проверены. - Текст, превышающий лимиты полей (например, Ozon может ограничивать описание 1000 символами) будет обрезан или сокращён моделью (можно попросить модель уложиться в N символов). - JSON от модели проверяется парсером на корректность, лишние элементы убираются. - Нежелательные фрагменты (например, если модель случайно добавила что-то вроде "купите прямо сейчас" или контакт) будут отфильтрованы или отредактированы.

# Этапы реализации (алгоритм работы системы) 

Для ясности представим пошаговый алгоритм, как система будет выполнять задачи по оптимизации карточек:

1. Инициализация и выбор товара(ов): Система получает на вход список SKU или идентификаторов товаров, требующих оптимизации. Этот список может быть сформирован различными способами: вручную (указаны конкретные проблемные товары) или автоматически (например, ежедневный запуск, проверяющий все товары и отбирающий те, у которых рейтинг < 100). На этом же этапе загружаются конфигурации: ключи API, параметры LLM (например, модель, темп затрат токенов) и настройки ограничений.
2. Получение контент-рейтинга: Для каждого товара (или пачки товаров) вызывается Ozon API метод rating-by-sku. Можно запросить сразу несколько SKU списком, если ограничение API позволяет, чтобы снизить количество запросов. Результат парсится: из него извлекается числовой рейтинг и список невыполненных условий (там, где "fulfilled": false). Например, будет получено что-то вроде: rating $=70$, невыполненные: Rich-контент, Видео, Видеообложка 19. Система сохраняет эти данные в структуре (например, объект ProductIssues с полями CurrentRating, MissingRichContent=true, MissingVideo=true, MissingVideoCover=true, ShortDescription=false и т.д. по каждому условию).
3. Получение текущего содержимого карточки: Если рейтинг уже 100 - пропускаем товар (идемпотентность: ничего делать не надо). Если нет, система запрашивает более подробные данные:
4. Вызов product/info/list (или похожего) для получения имеющихся атрибутов, названия, категории, картинок.
5. Вызов product/info/description для получения текстового описания.
6. Optionally: вызов метода получения значений характеристик (Ozon может позволять запросить список всех характеристик с названиями и текущими значениями). Если это не отдельный метод, информация частично содержится в ответе info/list (например, может быть поле attributes с заполненными ID и value). Надо проанализировать ответ: какие атрибуты уже заполнены, какие отсутствуют (можно сверить с полным списком обязательных/необязательных для категории, если есть).
7. Эти данные собираются для передачи в LLM. Также сохраняется копия для сравнения после (чтобы понимать, что изменилось).
8. Формирование задания для LLM: На основе собранной информации подготавливается текст запроса (prompt) для ChatGPT. Можно сформировать его программно как многострочный текст:
9. Инструкция системе (system message) примерно: "Ты - помощник для улучшения товарных карточек на маркетплейсе. Твоя задача - на основании вводных данных о товаре подготовить улучшенное описание и указать, какие данные добавить, чтобы карточка стала лучше. Формат ответа: сначала обновлённое описание, затем - блок 'RichContent' с разделами, затем - блок 'Attributes' с недостающими характеристиками." (Это пример формат можно упростить или сделать несколько отдельных запросов).

10. Сообщение пользоватея (user message) включает:

- Название товара, категорию, бренд.
- Текущее описание (если пустое, явно указать, что описание отсутствует).
- Список проблем: может быть перечислено списком или фразами. Например: "Проблемы: 1) Отсутствует расширенный контент (Rich-контент). 2) Нет видеообзора товара. 3) В описание менее 500 символов. 4) Не заполнены характеристики: Материал, Гарантия."
- Дополнительные данные: уже известные атрибуты (например: "Материал: пластик, Цвет: красный, ..."). Это нужно, чтобы модель не противоречила тому, что уже есть.
- Просьба: "Напиши новое описание товара на русском языке, учитывая вышеуказанные проблемы, и предложи структуру расширенного контента. Добавь недостающую информацию, если она известна из контекста." При необходимости можно уточнить стиль: "Описание должно быть информативным, без воды, объем 800 символов, разделённое на абзацы."

11. Технически, используется API вызов /v1/chat/completions с моделью GPT-4, messages $=$ [system, user], temperature небольшой (около 0.7 для креативности, но не слишком рандомно).
12. Получение и обработка ответа LLM: Модель возвращает ответ, который парсится. Предположим, она вернула текст, где:
13. Первый абзац - новое описание.
14. Затем, например, заголовки секций для Rich-контента: "\#\#\# Особенности" и список пунктов, "\#\#\# Что вы получите" и т.д.
15. В конце, может, перечислены недостающие атрибуты: "Недостающие характеристики: Материал - силикон; Гарантийный срок - 12 месяцев." Если ответ не структурирован строго, возможно, стоит делать несколько запросов: 1) один - только для описания (чтобы получить чистый параграф текста), 2) второй - для Rich-контента (дать модель уконкретнённую задачу: "Сгенерируй JSON с 2 секциями..."). Выбранный подход уточняется в реализации, но для ТЗ достаточно описать, что мы получаем все необходимые текстовые фрагменты от AI.

После получения: - Проверяем длину описания, при необходимости укорачиваем или просим модель пересгенерировать с нужным размером. - Проверяем, не употреблены ли запрещённые слова (можно проанализировать по списку стоп-слов Ozon). - Валидация JSON: если модель выдаст JSON (например, в markdown-блоке кода), его нужно распарсить. Если модель выдала псевдокод (markdown), можно конвертировать: мы знаем структуру (название секции -> текст -> может список). Конвертируем в требуемный Ozon JSON-формат для RichContent. B Ozon RichContent JSON обычно выглядит как массив блоков, каждый блок - это объект с типом (например, "TEXT", "HEADER", "LIST", "IMAGE"), значением и настройками стиля. Мы либо используем шаблон и вставляем сгенерированный текст, либо, если Ozon предоставляет визуальный конструктор, можем ограничиться вставкой HTML, но вероятнее нужен JSON. - По атрибутам: модель могла предложить значения. Проверяем их. Если они корректны и у нас есть ID соответствующих атрибутов, добавляем в структуру обновления. Если сомнения - можно пропустить автоматическое заполнение, оставив уведомление для пользователя.

1. Формирование структуры обновлённых данных: Теперь собираем обновлённые данные в формате, пригодном для product/import . Это включает:

2. offer_id (или SKU + возможно product_id) чтобы однозначно указать, что обновляем.
3. Новый description = текст описания от LLM (обычно Ozon на уровне import может брать этот параметр как аннотацию).
4. В блок attributes:

- Заполнение недостающих характеристик: для каждого определяем id (нужно заранее иметь соответствие название->id, возможно с помощью словаря атрибутов категории), и ставим value или dictionary_value_id. Например, Материал - id 17034, value "силикон".
- Если модель предложила что-то, чего мы не уверены, лучше не вставлять, либо отметить attributes и не ставить значение (но пустой атрибут смысла не имеет). Поэтому либо точно заполняем, либо пропускаем.

5. В блок complex_attributes:

- Добавляем объект RichContent: атрибут с id (как выяснили, скажем 11254) и value = строка JSON (нужно экранировать внутри JSON запроса или передавать как JSONобъект, смотря как API ожидает).
- Если есть видео:
- Если у пользователя есть ссылка на видео (можно предусмотреть в конфигурации поля "defaultVideoUrl" на товар или глобально), вставляем атрибут id 21841 = ссылка, и id 21837 = какое-то имя (например, "Видео1"). Но скорее видео будет добавляться вручную. На этапе автоматизации, можем пропустить, но тогда рейтинг не достигнет 100. Если важно автоматом 100, возможно, стоит иметь заглушечное видео (например, общий обзор компании). Но это бизнес-решение.
- С видеообложкой аналогично: id 21845 = ссылка на картинку (заглушка или брендовый баннер).
- Добавляем недостающие изображения, если они есть. Автоматически система сама новые фото не сделает, но если, скажем, в базе компании есть URL дополнительных изображений (например, фото с разных ракурсов хранятся в DAM-системе), можно подключить. В противном случае, можно оставить как есть, и карточка просто не наберёт 20 баллов из медиа. Однако, для полного соответствия ТЗ "всё необходимое", предположим, что компания готова предоставить ресурсы: т.е. в системе может быть конфигурация, что к каждому товару должен быть как минимум 1 общий баннер. Тогда если фото < 3, можно добавить стандартное изображение (логотип, сертификат качества и т.п.). Этот момент обсуждаем с заказчиком - для ТЗ укажем, что требуется минимум 3 изображения и их добавление вне компетенции LLM, но система должна отслеживать этот параметр.

6. Таким образом, формируется JSON, близкий по структуре к примеру, который мы получили из документации (см. выше). Убедившись, что все обязательные поля присутствуют (например, name, price - хотя их менять не нужно, но Ozon требует передавать текущие значения, иначе обнулит; поэтому мы предварительно получили старые данные, и вставим их в запрос, если они обязательны). DTO для product/import взят из документации Ozon 20 .
7. Отправка обновления и получение результата: Выполняется POST запрос на /v3/ product/import с подготовленным телом. Получаем ответ с task_id. Далее в цикле (или с паузой) опрашиваем /v1/product/import/info (или новый /v3/product/ import/info, если есть) до получения status = success или failed. Если ошибка:

8. Анализируем, что не так. Ozon обычно вернёт список ошибок в структуре (например, неверный ID атрибута, или "значение слишком длинное", или "недопустимый JSON формат"). Эти ошибки можно также передать в LLM для интерпретации или прямо вывести разработчику. На этапе разработки ТЗ мы предполагаем, что могут быть ошибки, связанные с JSON (неправильный формат), либо с бизнес-правилами (например, попытка обновить архивный товар, или товар без активного договора - как в примере, когда был код SELLER_NO_CONTRACT_FAILED 21). Такие случаи нужно предусмотреть: если договор неактивен - сначала возобновить контракт, только потом контент править.
9. После устранения причины запускаем обновление снова (идея идемпотентности: запрос можно повторять, доводя до успеха, при этом состояние товара либо не меняется, либо становится лучше).

Если обновление успешно: переходим дальше.

1. Валидация нового контент-рейтинга: После успешного обновления, можно подождать несколько секунд и снова вызвать rating-by-sku для этого SKU. В ответе ожидаем увидеть рейтинг, ближе к 100. Если получили 100 - отлично, задача выполнена. Если, например, 90 - значит что-то ещё не выполнено:
2. Смотрим, какие условия всё ещё fulfilled=false Например, возможно, видео не добавлено, и за него -10 баллов. Либо LLM-сгенерированное описание хоть и длинное, но, скажем, не превысило 500 символов (маловероятно, но вдруг). Тогда можно принять решение: либо отметить, что без видео 100 недостижимо, либо (если принципиально 100) - сообщить, что необходим видео-контент.
3. Здесь возможно вмешательство человека: система может сформировать отчёт, что для SKU Х осталось сделать вручную: "добавить видео", после чего повторно запустить оптимизацию.
4. Если же какие-то поля не сохранились (например, Rich-контент не отобразился из-за ошибки) - в контент-рейтинге опять будет пункт незакрыт. Тогда можно отладить JSON и повторить шаг обновления.
5. Идемпотентность: важно, что повторный запуск шага 7 с теми же данными не должен ухудшить ситуацию. Если, например, карточка уже имеет описание и мы ещё раз его отправим таким же - ничего страшного, Ozon просто перезапишет на то же значение. Если мы добавили Rich-контент, второй раз добавление идентичного Rich-контента не приведёт к дублированию (система Ozon просто заменит содержимое поля на такое же). Главное не создавать дубликаты видео: к примеру, Ozon может позволять несколько видео в карточке. Нам не нужно добавлять видео вторично, если оно уже есть. Поэтому на втором проходе, анализируя рейтинг, мы увидим, что условия по видео выполнены и не будем повторно слать видео. Таким образом, алгоритм гарантирует, что одно и то же улучшение не применяется дважды.
6. Логирование и отчёт: Система ведёт журнал изменений: какой SKU, что было до (рейтинг, ключевые проблемы) и что стало после (новый рейтинг, список внесённых изменений). Полезно сохранить сгенерированный AI текст, и финальный JSON где-нибудь, чтобы в будущем, при доработках, можно было посмотреть историю. Отчёт может быть представлен в человеко-читаемом виде: "Товар X: рейтинг 70 -> 100. Добавлено: описание переписано, добавлен Rich-контент, заполнены атрибуты Материал и Гарантия, добавлено видео." Если что-то не удалось - сообщается. Это также поможет в дальнейшем масштабировании и привлечении человека на сложных случаях.

Эти шаги будут оформлены программно как модули/классы: OzonApiClient, ContentAnalyzer (LLM part), ContentUpdater, Verifier, Logger и orchestrator flow, что облегчает поддержку и модификацию.

# Учёт ограничений технологии и гибкость системы 

При реализации необходимо учитывать текущие ограничения технологий (как со стороны Ozon API, так и со стороны LLM) и обеспечить гибкость решения в части настроек времени выполнения и объёма обрабатываемых данных:

- Ограничения Ozon API: Ozon накладывает лимиты на количество запросов в минуту и количество элементов в одном запросе. Точные ограничения указаны в документации (например, не более 100 запросов rating-by-sku в минуту, или не более 100 SKU за раз). Система должна быть спроектирована с возможностью настройки задержек между запросами и размера батчей. Например, можно обрабатывать по 50 товаров за итерацию, затем пауза 1 минута. Эти параметры (BatchSize, RateLimitDelay) выносятся в конфиг, чтобы при изменении политики Ozon легко их корректировать.
- Ограничения OpenAI: Вызов ChatGPT API платный и тоже может иметь ограничения по RPS (requests per second) и по объёму запросов. Формирование слишком длинного prompt'a (например, если описание товара огромное или перечисление всех атрибутов) может привести к превышению лимита токенов. Поэтому:
- Следует ограничивать объем данных, передаваемых модели. Например, если описание > 1000 символов, можно не давать весь текст, а лишь первую и последнюю часть или краткое резюме. Основной смысл - чтобы модель понимала контекст, не обязательно подавать все дословно.
- Можно задать максимальную длину ответа от модели (параметр max_tokens в API).
- Если обрабатывается много товаров, вызывать модель последовательно для каждого может быть долго. В MVP-версии это приемлемо, но при масштабировании можно подумать о параллелизации с учётом лимитов. Например, 5 параллельных потоков, каждый обрабатывает свой SKU. Либо если GPT-4 слишком медленный, дать опцию переключиться на GPT-3.5 (хуже качество, но быстрее/дешевле).
- Финансовый аспект: интегратор системы должен иметь API-ключ OpenAI с достаточным балансом, поэтому возможно стоит реализовать счётчик токенов и оценку стоимости на элемент, чтобы не превысить бюджет.
- Точность LLM и валидация: Как уже упоминалось, модель может галлюцинировать - т.е. выдумать факт. Это недопустимо для характеристик товара. Поэтому система не должна автоматически доверять таким фактам. Все критичные данные должны либо приходить от Ozon (которые, в свою очередь, введены продавцом ранее), либо запрашиваться у человека. Например, если LLM пишет "Гарантия 12 месяцев", а продавец не давал такой информации - нужно проверить. В идеале, подключить справочник: может, по категории "электроника" обычно гарантия 12 мес, но это предположение. Пока лучше оставить это поле пустым, чем заполнить неверно. Таким образом, ограничение LLM - склонность придумывать - смягчается правилом: заполнять автоматически только то, что уверенно известно. Остальное - выносить в рекомендации без внесения.
- Ограничения Rich-контента: JSON-код не должен превышать определённый размер. Нужно внимательно отнестись к объёму текста, который мы вкладываем. Например, если описание 1000 символов, а мы делаем Rich-контент с несколькими секциями, итоговый

JSON может получиться крупным. Лучше ограничить, скажем, 3-4 секции, по абзацу каждая, и 1-2 изображения. Этого достаточно, чтобы удовлетворить требование. Также убедиться, что JSON валидный: возможно, стоит использовать официальный валидатор или отправить его через API метод проверки (в документации, возможно, есть метод предпросмотра RichContent, но не уверен).

- Модерация и качество: После автоматического обновления карточка может попасть на повторную модерацию (если меняется описание, Ozon вероятно прогонит её через проверку на запрещённый контент). Важно не нарушить правил, иначе товар может быть снят с продажи. Поэтому лучше перестраховаться: не включать в описание слов типа "лучший", "гарантирует", конкретных сравнений. LLM надо об этом явно сказать. Также, никаких упоминаний других сайтов, контактов. Если товар - медицинский, косметика, там особые требования (никаких лечебных заявлений и т.п.). В общем, ограничение - знание нюансов каждой категории. Мы можем хранить набор стоп-фраз и проверять финальный текст. Возможно, использовать сам OpenAI для контент-модерации (есть модель модерации), но на русском может не всё ловить, лучше иметь список.
- Идемпотентность и повторяемость: Система должна давать стабильный результат при повторных запусках на одном и том же входе. Чтобы этого достичь, можно:
- Фиксировать random seed у LLM (неявно сделать сложно, но можно снизить temperature, чтобы уменьшить вариативность).
- Использовать шаблоны: например, всегда одна и та же структура Rich-контента для данной категории. Тогда даже если описание перегенерируется, каркас останется.
- Если система видит, что уже исправляла данный товар (можно сохранять флаг или версию в базе данных, или просто по тому, что рейтинг уже 100), то она не будет заново дергать LLM. Либо, если запустили принудительно, можно добавить параметр "forceRewrite" - но по умолчанию не переписывать то, что уже хорошо.
- При групповой обработке большого объёма товаров можно параллельно или последовательно выполнять - главное, чтобы не возникло гонок данных. Например, два процесса не должны одновременно обновлять один SKU. Здесь можно либо блокировать на уровне кода, либо полагаться, что такого сценария не будет, если планировщик правильно настроен.
- Гибкость по времени запуска: Реализуемое решение должно легко интегрироваться в разные сценарии:
- Ручной запуск: по требованию пользователя (нажал кнопку "Оптимизировать карточку" в интерфейсе - и пошёл процесс).
- Периодический автозапуск: например, раз в неделю система сама проверяет все товары. Для этого компонент можно встроить как задачу в планировщик (Cron, Windows Scheduled Task, Azure Function TimerTrigger). Частота настраивается - можно вынести в настройки (e.g., runAt 02:00 каждую ночь).
- Обработка по событию: при создании или обновлении карточки - если контент-рейтинг сразу доступен и <100, можно триггерить улучшение. Но, возможно, лучше отложить на несколько минут, чтобы дали заполнить хотя бы обязательные поля вручную. Этот вариант можно предусмотреть, если есть webhook или event от Ozon (например, при смене статуса модерации).

- Гибкость по объёму данных:
- Система должна уметь работать как с единичным товаром, так и с тысячами. Для этого важна оптимизация: батчинг запросов к Ozon (где возможно), параллелизм генерации контента (с учётом токенов и стоимости), и возможность пропускать товары, которые не нуждаются в изменениях (чтобы не тратить ресурс).
- Стоит предусмотреть фильтры: например, обрабатывать только товары в продаже (неархивированные), или только определённых категорий (можно указать список категорий, требующих улучшения первым делом).
- При очень большом каталоге возможно, что за один прогон всё не успеется обработать (ограничения по времени, ставящие например max 100 товаров за ночь). Поэтому можно делать поэтапно: сегодня 100, завтра следующие 100, и так далее. Гибкость достигается параметрами: максимум товаров за запуск, паузы, приоритеты. Все эти настройки описать в конфигурационном файле и в документации к системе.
- Тестирование и откат: Внедряя автоматическую генерацию контента, нужно предусмотреть, что результаты должны быть проверены. На этапе опытной эксплуатации желательно настроить режим "только анализ", когда система не делает реальных обновлений, а лишь генерирует отчёт с рекомендациями. Этот отчёт можно дать команде контент-менеджеров на проверку. После одобрения включить режим "авто-правки". Также, даже после автозаполнения, нужно, чтобы человек посмотрел карточки - вдруг AI-текст получился не идеален стилистически или есть неточности. Поэтому удобно, если в системе будет предусмотрена возможность отката изменений: например, хранить старый текст описания, чтобы можно было вернуть, если новый вариант не понравился. Ozon API не предоставляет версионирование, но мы можем сохранять прошлое описание в своей БД.
- Совместимость с .NET 8: .NET 8 - современная платформа, проблем со сторонними API быть не должно. Надо убедиться, что используемые библиотеки (например, для JSON, HTTP, OpenAI SDK) совместимы. Также .NET 8 позволяет удобно реализовать асинхронность (async/await для вызовов API). Можно задействовать механизм BackgroundService или HostedService, если это будет долгоживущее приложение, или просто консольное приложение под планировщик.
- Безопасность данных: При работе с внешним AI API, мы отправляем данные о товаре, которые могут быть конфиденциальными (например, внутренние описания или планы). В OpenAI API соглашении указано, что они могут использовать присылаемые данные для обучения, если не отключить логирование. Нужно решить, приемлемо ли это. Если нет, возможно рассмотреть вариант размещения LLM on-premise (например, Azure OpenAI с отключенным логированием, или локальная модель). В рамках данного ТЗ, однако, предполагается использование публичного API. Тогда, как минимум, не передавать лишней информации: например, идентификаторы или персональные данные. Описания товаров в целом не секретны (они и так публикуются на витрине), так что риск минимален.

В итоге, система должна получиться надёжной, гибкой и масштабируемой. Все параметры, влияющие на производительность и поведение, выносятся в настройки, а разработка ведётся с учётом возможных изменений API Ozon или OpenAI. Благодаря идемпотентности алгоритма, повторный запуск на тех же данных не приведёт к конфликтам или дублированию, что упрощает отладку и эксплуатацию.

# Заключение 

В данном техническом задании подробно описано решение для автоматизированной оптимизации контента карточек товаров на Ozon с помощью инструментов LLM. Мы учли документацию разработчика Ozon (методы API и структуры данных) и включили всё необходимое, чтобы карточки достигали максимального контент-рейтинга 11. Решение охватывает анализ текущего состояния карточки, генерацию улучшенного контента (текста, richконтента) на основе рекомендаций Ozon 11 15, а также непосредственное внесение правок через Ozon API. Особое внимание уделено ограничениям - как технологическим, так и бизнесправилам - и тому, чтобы система была гибко настраиваемой и безопасной.

Ожидаемые результаты: После внедрения системы продавцы на Ozon смогут значительно улучшить качество своих карточек с минимальными ручными усилиями. Карточки, автоматически дополненные необходимой информацией и мультимедиа, получат 100 баллов контент-рейтинга, что, по информации Ozon, делает товар более привлекательным для покупателей и повышает его позицию в списке предложений 22. Благодаря интеграции с OpenAI, текстовый контент будет генерироваться быстро и с высоким качеством, а разработчики смогут легко расширять функциональность (например, добавить режим диалогового помощника для контент-менеджеров). Система разработана таким образом, чтобы быть устойчивой к повторным запускам и изменениям объёма данных, обеспечивая корректную идемпотентную работу при любых сценариях.

Дальнейшие шаги: На следующем этапе, после утверждения ТЗ, команда разработки приступит к реализации: настройке доступа к API, кодированию модулей, и поэтапному тестированию (сначала на нескольких тестовых товарах, затем в боевом окружении). В перспективе систему можно интегрировать с другими инструментами (например, PIM-система компании) и расширить под другие маркетплейсы, но ядро - анализ и генерация контента с помощью LLM - останется тем же. Этот проект объединяет возможности AI и требования e-commerce, что позволит добиться быстрого и качественного улучшения контента товарных карточек.

[^0]
[^0]:    (1) 1516 Получить контент-рейтинг товаров по SKU | Документация Ozon Seller API | Postman API Network
    https://www.postman.com/googlesheets/ozon-seller-api/request/2pmbb1c/sku
    (2) 2223 Получить информацию о товарах | Открытый Пакет Интеграций
    https://openintegrations.dev/docs/Ozon/Uploading-and-updating-products/Get-products-information/
    (3) 13 Получить описание товара | Открытый Пакет Интеграций
    https://openintegrations.dev/docs/Ozon/Uploading-and-updating-products/Get-product-description/
    (4) The official .NET library for the OpenAI API - GitHub
    https://github.com/openai/openai-dotnet
    (5) (6) (7) (8) 1425 Создать обновить товары | Открытый Пакет Интеграций
    https://openintegrations.dev/docs/Ozon/Uploading-and-updating-products/Create-update-products/
    (9) 1617171819 Получить контент рейтинг товаров | Открытый Пакет Интеграций
    https://openintegrations.dev/docs/Ozon/Uploading-and-updating-products/Get-products-content-rating/
    22 Контент-рейтинг - База знаний - OZON
    https://seller-edu.ozon.ru/work-with-goods/reference-goods/content-rating

